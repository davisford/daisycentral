// Hogan Template Engine wrapper for SocketStream 0.3

var hogan = require('hogan.js');

exports.init = function(root, config) {

  // Set global/window variable used to access templates from the browser
  var namespace = config && config.namespace || 'HT'

  return {

    name: 'Hogan',

    // Opening code to use when a Hogan template is called for the first time
    prefix: function() {
      return '<script type="text/javascript">if(!window.' + namespace + '){window.' + namespace + ' = {};}';
    },

    // Closing code once all Hogan templates have been written into the <script> tag
    suffix: function() {
      return '</script>';
    },

    // Compile template into a function and attach to window.<windowVar>
    process: function(template, path, id) {

      var compiledTemplate = hogan.compile(template, {asString: true});

      return 'window.' + namespace + '[\'' + id + '\'] = new Hogan.Template(' + compiledTemplate + ');';    
    }
  }
}